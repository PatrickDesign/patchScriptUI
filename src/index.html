<!DOCTYPE html>
<html lang="en">
<head>
  
  <!--  Meta  -->
  <meta charset="UTF-8" />
  <title>My New Pen!</title>
  
  <!--  Styles  -->
  <link rel="stylesheet" href="styles/index.processed.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
  
  <nav class="navbar navbar-expand-sm navbar-dark bg-primary mb-3">
        <div class="container">
            <a class="navbar-brand" href="/">Logo</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto">
                        <li class="nav-item dropdown">
                            <a href="" class="nav-link dropdown-toggle"
                            data-toggle="dropdown" id="navbarDropdownMenuLink">Your Ideas</a>
                            <div class="dropdown-menu">
                                <a href="#" class="dropdown-item">Ideas</a>
                                <a href="#" class="dropdown-item">Add</a>
                            </div>
                        </li>
                        <li class="nav-item">
                        <a href="#" class="nav-link">Logout</a>
                    </li>

                        <li class="nav-item">
                            <a href="#" class="nav-link">Login</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">Register</a>
                        </li>
                </ul>
            </div>
        </div>
    </nav>

    <main role="main" class="container">

      <div class="container">
        <h1>Title of this section</h1>
        <p class="lead">Use this document as a way to quickly start any new project.<br>
          All you get is this text and a mostly barebones HTML document.</p>
      </div>

      <div class="row">
        <!-- Component Placeholders -->
        <div class="col-sm-6" id="renderHere"></div>
        <div class="col-sm-6" id="renderHere2"></div>
        <div class="col-sm-12" id="favoriteTreats"></div>
        <hr>
        <div class="col-sm-12" id="powersOfTwo"></div>
        <!--<div class="col-sm-12" id="colorChanger"></div>-->
        <div class="col-sm-12" id="colorChangerContainer"></div>
      </div>
    </main><!-- /.container -->


  


  
  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>

  <!-- Framework files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="scripts/patchScript.js"></script>
  <!-- End Framework files -->
  <script>

    //===================================
    // Global Data to pass to components:
    //===================================

    const myUsers = [
      {
        firstName: "Michelle",
        lastName: "Michelleson",
        age: 92,
        weight: "please don't ask that"
      },
      {
        firstName: "Patrick",
        lastName: "Wees",
        age: 21,
        weight: "prefer not to answer"
      }
    ];

    const myFavoriteTreats = [
      "Sour Patch Kids",
      "Sour Patch Parents (walmart exclusive)",
      "Redvines (stale)",
      "hot DOGS.  From costco tho."
    ]

    //===================================
    // End Global Data
    //===================================

    //Component with dynamic template.
    function treatList(favoriteTreats)
    {
      function behavior()
      {
        $(this).find("li").on("click", function(){
          $(this).remove();
        });
      }

      return({
        template: `<ul>
                    ${favoriteTreats.map(treat => `<li>${treat}</li>`).join('')}
                  </ul>`,
        behavior
      })
    } 
    
    //Component Declaration
    function userListItem(user)
    {
      //Define component behavior:
      function behavior()
      {
        //our 'this' keyword is the HTMLNode that was created.  We can also access the 'user'
          //variable thanks to some cool js closures :)
        
        //For each <li> in our component, let's add an onclick function that reads it's innerHTML,
          //and alerts some prop value (just to test)
        $(this).find('li').on("click", function(){
          alert(`${$(this).html()} and my favorite name is ${user.firstName}`);
        });
        
      }
      
      return ({
        template: `<ul>
                      <li>User's firstName: ${user.firstName}</li>
                      <li>lastName: ${user.lastName}</li>
                      <li>age: ${user.age}</li>
                      <li>weight: ${user.weight}</li>
                    </ul>`,
        behavior
      });
    }

    //A component that returns it's options in an async fashion!
    async function powersOfTwo()
    {
      //define props
      var lastPowerOfTwo = 2;
      var numberFact = await axios.get(`http://numbersapi.com/${lastPowerOfTwo}/trivia?noFound=default`).then(numData => numData.data);

      function behavior()
      {
        $(this).find("li").first().on("click", async function()
        {
          var lastSibling = $(this).siblings().last();


          if(!lastSibling.length)

            lastSibling = $(this);

          var newPowerOfTwo = lastPowerOfTwo * 2;
          lastPowerOfTwo = newPowerOfTwo;

          numberFact = await axios.get(`http://numbersapi.com/${newPowerOfTwo}/trivia?noFound=default`).then(numData => numData.data);

          $(`<li>${numberFact}</li>`).insertAfter(lastSibling);
        });
      }

      return({
        template: `<ul>
                    <li>${numberFact}</li>
                  </ul>`,
        behavior
      })
    }


    //First example of component that renders children.
    function colorChangerContainer(numColorChangers)
    {

      var colorChangers = [];

      const removeFromContainer = function (componentToRemove)
      {
        const indexOfComponent = colorChangers.findIndex(el => el === componentToRemove && patchScript.detatchComponent(componentToRemove));
        colorChangers.splice(indexOfComponent, 1);
      };

      function behavior()
      {

        var containersToRegister = [];

        //register all containers:
        for(var i = 0; i < numColorChangers; i++)
        {
          //containersToRegister[i] = `${i}`;
          patchScript.registerContainers([`${i}`]);
          colorChangers.push(patchScript.createComponent(colorChanger(removeFromContainer), `${i}`));
        }

        //patchScript.registerContainers(containersToRegister);

        //for(var i = 0; i < numColorChangers; i++){
        //  colorChangers.push(patchScript.createComponent(colorChanger(removeFromContainer), `${i}`));
        //}
      }

      return({
        template: `<div>
                      <h1>Here are my favorite colors... I hope you like them!</h1>
                      <div class="row">
                        ${Array(numColorChangers).join(0).split(0).map((el, index) => `<div class="col-sm-3" id=${index}></div>`).join('')}
                      </div>
                  </div>
        `,
        behavior
      })

    }

    function colorChanger(removeFromContainer)
    {

      var numberOfTimesClicked = 0;

      function getColor()
      {
        return Math.random() * Math.floor(255)
      }

      function behavior()
      {

        var rgb = {
            r: getColor(),
            g: getColor(),
            b: getColor()
        }  

        $(this).css("background-color", `rgb(${rgb.r},${rgb.g}, ${rgb.b})`);

        $(this).on("click", function(){

            numberOfTimesClicked++;

            if(numberOfTimesClicked === 5)
            {
              return removeFromContainer(this);
            }
          
            rgb.r = getColor();
            rgb.g = getColor();
            rgb.b = getColor();     

          $(this).css("background-color", `rgb(${rgb.r},${rgb.g}, ${rgb.b})`);

        });
      }

      return(
        {
          template: `<div style="width:250px;height:250px">
                     </div>`,

          behavior
        }
      )
    }


    patchScript.registerContainers(['renderHere', 'renderHere2', 'favoriteTreats', 'powersOfTwo', 'colorChanger', 'colorChangerContainer']);

    //Actually create components and render them.
    patchScript.createComponent(userListItem(myUsers[0]), 'renderHere');
    patchScript.createComponent(userListItem(myUsers[1]), 'renderHere2');
    patchScript.createComponent(treatList(myFavoriteTreats), 'favoriteTreats');
    //patchScript.createComponent(colorChanger(), 'colorChanger');

    //Render an async component:
    var powerOfTwoComponent = powersOfTwo().then(twoComponent => {
      patchScript.createComponent(twoComponent, 'powersOfTwo');
    });

    //Render a component with children!!
    patchScript.createComponent(colorChangerContainer(48), 'colorChangerContainer')
    
  </script>
</body>
</html>